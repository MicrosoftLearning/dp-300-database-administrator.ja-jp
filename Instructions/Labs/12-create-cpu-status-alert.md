---
lab:
  title: ラボ 12 – SQL Server の CPU 状態アラートを作成する
  module: Automate database tasks for Azure SQL
---

# Azure 上の SQL Server の CPU 状態アラートを作成する

**推定所要時間:30 分**

あなたはデータベース管理の日常業務を自動化するために、シニア データ エンジニアとして採用されました。 この自動化はピーク時のパフォーマンスで AdventureWorks のデータベースの稼働を確実に続けるうえで役に立つだけでなく、特定の条件に基づいてアラートを生成することもできるようにします。

**注:**  これらの演習では、T-SQL コードをコピーして貼り付け、既存の SQL リソースを使うように求められることがあります。 コードを実行する前に、コードが正しくコピーされていることを確認してください。

## CPU の平均使用率が 80% を超えたときにアラートを生成する

1. Azure portal の上部にある検索バーで、「**SQL**」と入力し、**[SQL データベース]** を選択します。 一覧表示されている **AdventureWorksLT** データベース名を選択します。

    ![SQL データベースを選択しているスクリーンショット](../images/dp-300-module-12-lab-01.png)

1. **AdventureWorksLT** データベースのメイン ブレードで、[監視] セクションまで移動します。 **[警告(アラート)]** (アラート) を選択します。

    ![SQL データベースの概要ページでアラートを選択しているスクリーンショット](../images/dp-300-module-12-lab-02.png)

1. **[アラート ルールの作成]** を選択します。

    ![[アラート ルールの作成] を選択しているスクリーンショット](../images/dp-300-module-12-lab-03.png)

1. **[シグナルの選択]** スライドで、 **[CPU percentage]** を選択します。

    ![CPU の割合を選択しているスクリーンショット](../images/dp-300-module-12-lab-04.png)

1. **[シグナルの構成]** スライドで、 **[しきい値]** プロパティの **[Static(静的)]** を選択します。 **[演算子]** が **[次の値より大きい]** 、 **[集計の種類]** が **[平均]** であることを確認します。 次に、**[しきい値]** に **80** という値を入力します。 **[完了]** を選択します。

    ![「80」を入力して [完了] を選択しているスクリーンショット](../images/dp-300-module-12-lab-05.png)

1. **[[アクション]** タブを選択します。

    ![[アクション グループの選択] リンクを選択しているスクリーンショット](../images/dp-300-module-12-lab-06.png)

1. **[アクション]** タブで、 **[アクション グループの作成]** を選択します。

    ![[アクション グループの作成] を選択しているスクリーンショット](../images/dp-300-module-12-lab-07.png)

1. **[アクション グループ]** 画面で、 **[アクション グループ名]** フィールドに「**emailgroup**」と入力し、 **[次へ: 通知]** を選択します。

    ![「emailgroup」と入力し、[次へ: 通知] を選択しているスクリーンショット](../images/dp-300-module-12-lab-08.png)

1. **[通知]** タブで、次の詳細を入力します。

    - **通知の種類:** 電子メール/SMS メッセージ/プッシュ/音声
        - **メモ:** このオプションを選択すると、電子メール/SMS メッセージ/プッシュ/音声ポップアップが表示されます。 電子メール プロパティを確認し、サインインに使用した Azure ユーザー名を入力します。
    - **名前:** DemoLab

    ![[アクション グループの作成] ページに情報が追加されたスクリーンショット](../images/dp-300-module-12-lab-09.png)

1. **[確認と作成](確認と作成)** を選択し、次に **[作成]** を選択します。

    ![[アラート ルールの作成] ページで [アラート ルールの作成] を選択しているスクリーンショット](../images/dp-300-module-12-lab-10.png)

    **メモ:** **[作成]** を選択する前に、 **[アクション グループのテスト (プレビュー)]** を選択してアラートをテストすることもできます。

1. ルールが作成されると、入力した電子メール アドレスにこのようなメールが送信されます。

    ![確認メールのスクリーンショット](../images/dp-300-module-12-lab-11.png)

    アラートが設定されている場合、CPU の平均使用率が 80% を超えると、次のような電子メールが送信されます。

    ![警告メールのスクリーンショット](../images/dp-300-module-12-lab-12.png)

アラートを使用して、あるメトリック (データベース サイズや CPU 使用率など) が定義したしきい値に達したときに、電子メールを受け取る、または Web hook を呼び出すことができます。 Azure SQL Database のアラートを簡単に構成する方法を確認しました。
